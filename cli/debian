#!/bin/bash
set -e
source /usr/lib/sulin/dsl/variable.sh
get_root(){
    if [[ $UID -ne 0 ]]; then
        if which pkexec &>/dev/null && [[ "$NOPKEXEC" == "" ]] ; then
            echo "exec pkexec"
        else
            echo "su -c"
        fi
    else
        echo "env ROOTMODE=1"
    fi
}
if [[ "$1" == "--no-install" ]] ; then
    if [[ ! -f "${DESTDIR}/etc/os-release" ]] ; then
        exit 0
    fi
fi

if [[ -f "$1" ]] ; then
    cat $1 | $(get_root) /usr/lib/sulin/dsl/dsl.sh
elif [[ "$1" == "-c" ]] ; then
    shift
    echo "$*" | $(get_root) /usr/lib/sulin/dsl/dsl.sh
elif [[ "$1" == "--help" ]] ; then
    echo "debian [options]"
    echo "  --help         : Write this message"
    echo "  -c             : Run command from subsystem"
    echo "  --no-install   : Do not install if not installed."
else
    $(get_root) /usr/lib/sulin/dsl/dsl.sh
fi

